# Round 4: Risk & Constraints Analysis

**Date**: 2025-12-09
**Project**: IQFMP 智能量化因子挖掘平台

---

## 1. Risk Matrix Overview

| 风险类别 | 数量 | 极高 | 高 | 中 | 低 |
|----------|------|------|-----|-----|-----|
| 技术风险 | 5 | 1 | 2 | 2 | 0 |
| 市场风险 | 4 | 1 | 2 | 1 | 0 |
| 运营风险 | 4 | 2 | 1 | 1 | 0 |
| 合规风险 | 2 | 0 | 1 | 1 | 0 |
| 资源约束 | 3 | 1 | 1 | 1 | 0 |

---

## 2. Technical Risks (技术风险)

### TR-001: LLM 生成代码安全性 ⚠️ 极高风险
- **影响**: 极高 | **概率**: 85%
- **描述**: LLM 生成的因子代码可能包含安全漏洞、逻辑错误或恶意代码
- **缓解措施**:
  1. AST 静态分析 - 禁止危险函数调用 (eval, exec, __import__)
  2. 沙箱执行 - RestrictedPython 或 subprocess 隔离
  3. 人工审核门槛 - 新因子必须经过人工确认
  4. 代码签名机制 - 只执行已签名的因子

### TR-002: Qlib Fork 维护成本 ⚠️ 高风险
- **影响**: 高 | **概率**: 60%
- **描述**: Fork 版本与上游不同步，导致安全漏洞或功能缺失
- **缓解措施**:
  1. 最小化修改 - 只扩展不修改核心
  2. 自动化同步脚本 - 每周检查上游更新
  3. 接口隔离 - CryptoDataHandler 作为独立模块

### TR-003: LangGraph 版本稳定性 ⚠️ 高风险
- **影响**: 中 | **概率**: 70%
- **描述**: LangGraph 仍在快速迭代，API 可能变更
- **缓解措施**:
  1. 锁定版本 (0.2.x)
  2. 抽象层封装 - AgentOrchestrator 隔离底层 API
  3. 单元测试覆盖关键流程

### TR-004: 实时数据处理延迟 ⚠️ 中风险
- **影响**: 中 | **概率**: 50%
- **描述**: 数据延迟导致策略执行滞后
- **缓解措施**:
  1. TimescaleDB 连续聚合
  2. Redis 缓存热点数据
  3. WebSocket 直连交易所

### TR-005: 多交易所 API 差异 ⚠️ 中风险
- **影响**: 中 | **概率**: 55%
- **描述**: Binance/OKX API 行为不一致
- **缓解措施**:
  1. ccxt 统一抽象层
  2. 交易所适配器模式
  3. 完善错误处理和重试逻辑

---

## 3. Market Risks (市场风险)

### MR-001: 加密货币市场高波动性 ⚠️ 极高风险
- **影响**: 极高 | **概率**: 100%
- **描述**: 加密市场波动率远超传统市场
- **缓解措施**:
  1. 硬性止损规则 - 单笔最大亏损 2%
  2. 仓位限制 - 单策略最大仓位 10%
  3. 策略多样化 - 不同因子家族组合
  4. 动态风控阈值

### MR-002: 交易所 API 限流与稳定性 ⚠️ 高风险
- **影响**: 高 | **概率**: 65%
- **描述**: 交易所 API 限流或宕机
- **缓解措施**:
  1. 请求速率控制
  2. 多交易所备份
  3. 本地订单缓存

### MR-003: 流动性风险 ⚠️ 高风险
- **影响**: 高 | **概率**: 45%
- **描述**: 小市值币种滑点过大
- **缓解措施**:
  1. 流动性过滤 - 最小日成交量要求
  2. 分批下单 - TWAP/VWAP 执行
  3. 滑点预估模块

### MR-004: 跨市场套利风险 ⚠️ 中风险
- **影响**: 中 | **概率**: 40%
- **描述**: 跨交易所资金转移延迟
- **缓解措施**:
  1. 预置资金池
  2. 延迟套利策略设计

---

## 4. Operational Risks (运营风险)

### OR-001: 单人开发瓶颈 ⚠️ 极高风险
- **影响**: 极高 | **概率**: 90%
- **描述**: 12 周完成全功能 MVP 压力极大
- **缓解措施**:
  1. MVP 范围收窄 - P0 功能优先
  2. AI 辅助开发 - Claude Code 加速
  3. 复用开源组件 - ccxt, Qlib 核心
  4. Dashboard 降级为 CLI 监控

### OR-002: 7x24 实盘监控 ⚠️ 极高风险
- **影响**: 极高 | **概率**: 80%
- **描述**: 加密市场全天候运行
- **缓解措施**:
  1. 自动化告警 (Telegram/Slack)
  2. 异常自动暂停交易
  3. 移动端监控 App
  4. 保守策略参数

### OR-003: 灾难恢复 ⚠️ 高风险
- **影响**: 高 | **概率**: 30%
- **描述**: 系统故障导致无法交易
- **缓解措施**:
  1. 数据库备份 (TimescaleDB continuous backup)
  2. 多节点部署
  3. 手动平仓机制

### OR-004: 密钥管理 ⚠️ 中风险
- **影响**: 高 | **概率**: 25%
- **描述**: API Key 泄露
- **缓解措施**:
  1. 环境变量 + Vault
  2. IP 白名单
  3. 只读权限分离

---

## 5. Compliance Risks (合规风险)

### CR-001: 加密货币监管不确定性 ⚠️ 高风险
- **影响**: 高 | **概率**: 50%
- **描述**: 各国监管政策变化
- **缓解措施**:
  1. 选择合规交易所
  2. 个人使用定位
  3. 避免高频做市

### CR-002: KYC/AML 要求 ⚠️ 中风险
- **影响**: 中 | **概率**: 60%
- **描述**: 交易所 KYC 审核
- **缓解措施**:
  1. 提前完成 KYC
  2. 多账户备份

---

## 6. Resource Constraints (资源约束)

### RC-001: 12 周开发时间 ⚠️ 极高风险
- **影响**: 极高 | **概率**: 75%
- **描述**: MVP 时间紧迫
- **缓解措施**:
  1. 精简 MVP 范围
  2. 每周交付可测试版本
  3. 优先级严格排序

### RC-002: 计算资源成本 ⚠️ 高风险
- **影响**: 高 | **概率**: 60%
- **描述**: 回测与训练需要大量计算
- **月度预估**:
  - 云计算: ~$400
  - LLM API: ~$210
  - 总计: ~$610/月
- **缓解措施**:
  1. 本地开发 + 云端生产
  2. 增量回测
  3. DeepSeek 低成本模型优先

### RC-003: API 调用配额 ⚠️ 中风险
- **影响**: 中 | **概率**: 50%
- **描述**: 交易所和 LLM API 限额
- **缓解措施**:
  1. 请求缓存
  2. 批量处理
  3. Fallback 模型链

---

## 7. Key Decision Points (待确认)

| # | 决策点 | 选项 | 建议 |
|---|--------|------|------|
| 1 | MVP 功能范围 | 精简版 / 完整版 | 精简版 (优先因子生成+回测) |
| 2 | LLM 安全策略 | 严格 / 宽松 / 混合 | 混合 (AST检查+人工确认关键策略) |
| 3 | Qlib 集成深度 | 深度 Fork / 浅层集成 | 浅层集成 (只扩展 DataHandler) |
| 4 | 系统定位 | 生产系统 / 研究工具 | 研究工具优先，逐步生产化 |
| 5 | 监控策略 | 全自动 / 半自动 | 半自动 (自动告警+人工确认大额) |

---

## 8. Mitigation Priority Matrix

```
紧急度 ↑
        │ TR-001 (LLM安全)  │ OR-001 (单人瓶颈)
  高    │ MR-001 (市场波动)  │ RC-001 (时间约束)
        ├─────────────────────┼────────────────────
        │ TR-002 (Qlib维护)   │ OR-002 (7x24监控)
  中    │ MR-002 (API限流)    │ CR-001 (合规)
        ├─────────────────────┼────────────────────
  低    │ TR-003 (LangGraph)  │ RC-003 (API配额)
        └─────────────────────┴────────────────────
             高                    中          → 影响度
```

---

## 9. Risk Response Plan

### Phase 1 (Week 1-4): 基础风险控制
- [ ] 实现 AST 安全检查器
- [ ] 配置 Qlib 浅层集成
- [ ] 建立基础监控告警

### Phase 2 (Week 5-8): 市场风险防护
- [ ] 实现风控模块 (止损/仓位)
- [ ] 多交易所 failover
- [ ] Research Ledger 集成

### Phase 3 (Week 9-12): 运营稳定性
- [ ] 自动化告警系统
- [ ] 灾难恢复演练
- [ ] 文档与监控完善

---

**Analysis Status**: Complete ✅
**Next Step**: User confirmation on 5 decision points
